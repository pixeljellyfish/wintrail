/*********************************************************************
*  #### Simple Particle Engine v3.0 (Work in progress!) ####
*  Coded by Jason Mayes 2014. www.jasonmayes.com
*  Please keep this disclaimer with my code if you use it. Thanks. :-)
*  Got feedback or questions, ask here:
*  http://plus.google.com/+JasonMayes/posts
 * Updates will be posted to this site:
 * http://www.jasonmayes.com/projects/particleEngine/
 * Or see Github:
 * https://github.com/jasonmayes/Particle-Engine
*********************************************************************/
window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};var jmParticleEngine=function(){var t=null,e=null,i=[];function a(t,e,i,a,r,s,n,l,c,o,h,p,m){this.x=t,this.y=e,this.width=i,this.height=a,this.rotation=r,this.xVelocity=s,this.yVelocity=n,this.maxLife=l,this.life=l,this.growthType=c,this.r=o,this.g=h,this.b=p,this.image=m}function r(t,i,a,r,s){this.ctx=e||s,this.x=t,this.y=i,this.maxParticles=a||500,this.particles=[],this.generateParticle=r,this.emit=!1,this.images=[]}function s(t,e,i){var a={};(a="string"==typeof t?document.getElementById(t):t).addEventListener?a.addEventListener(e,i,!1):a.attachEvent?a.attachEvent("on"+e,i):a["on"+e]=i}function n(t,e,i,a,r){0!==e.rotation?(t.save(),t.translate(e.x,e.y),t.rotate(e.rotation),void 0!==r?t.drawImage(r,-i/2,-a/2,i,a):t.fillRect(-i/2,-a/2,i,a),t.restore()):void 0!==r?t.drawImage(r,e.x,e.y,i,a):t.fillRect(e.x,e.y,i,a)}function l(e){for(var a=i.length,r=0,s=0;a--;){if(i[a].fetchCtx().clearRect(0,0,t.width,t.height),i[a].particles.length===i[a].maxParticles&&i[a].particles.shift(),i[a].emit){var c=i[a].maxParticles-i[a].particles.length,o=Math.ceil(.01*c);if(c>0)for(var h=0;h<o;)i[a].particles.push(i[a].generateParticle()),h++}for(var p=i[a].particles.length;p--;)i[a].particles[p].life>0?(1===i[a].particles[p].growthType?(r=i[a].particles[p].life/i[a].particles[p].maxLife*i[a].particles[p].width,s=i[a].particles[p].life/i[a].particles[p].maxLife*i[a].particles[p].height):2===i[a].particles[p].growthType?(r=(1-i[a].particles[p].life/i[a].particles[p].maxLife)*i[a].particles[p].width,s=(1-i[a].particles[p].life/i[a].particles[p].maxLife)*i[a].particles[p].height):(r=i[a].particles[p].width,s=i[a].particles[p].height),void 0===i[a].particles[p].image?(i[a].fetchCtx().fillStyle="rgba("+i[a].particles[p].r+","+i[a].particles[p].g+","+i[a].particles[p].b+", 1)",i[a].fetchCtx().globalAlpha=i[a].particles[p].life/i[a].particles[p].maxLife,n(i[a].fetchCtx(),i[a].particles[p],r,s)):void 0!==i[a].images[i[a].particles[p].image]&&i[a].images[i[a].particles[p].image].loaded&&(i[a].fetchCtx().globalAlpha=i[a].particles[p].life/i[a].particles[p].maxLife,n(i[a].fetchCtx(),i[a].particles[p],r,s,i[a].images[i[a].particles[p].image].image)),i[a].particles[p].x+=i[a].particles[p].xVelocity,i[a].particles[p].y+=i[a].particles[p].yVelocity,i[a].particles[p].life--):i[a].particles.splice(p,1)}requestAnimationFrame(l,t)}return r.prototype.start=function(){this.emit=!0},r.prototype.stop=function(){this.emit=!1},r.prototype.fetchCtx=function(){return this.ctx},r.prototype.preloadImage=function(t){var e=new Image,i=this,a=this.images.length;return i.images.push({image:e,loaded:!1}),this.attachHandler(e,"load",function(){i.images[a].loaded=!0}),e.crossOrigin="",e.src=t,a},r.prototype.attachHandler=s,{init:function(i,a,r){(t=document.getElementById(i)).width=a,t.height=r,e=t.getContext("2d"),l()},generateEmitter:function(t,e,i,a,s){return new r(t,e,i,a,s)},generateParticle:function(t,e,i,r,s,n,l,c,o,h,p,m,f){return new a(t,e,i,r,s,n,l,c,o,h,p,m,f)},addEmitter:function(t,e){void 0!==e&&e&&t.start(),i.push(t)},randomNumber:function(t,e,i){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=!0),i?Math.round(Math.random()*t-e):Math.random()*t-e},attachHandler:s}}();